<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Digital</title>
<style>
  :root {
    --primary-dark: #0b3d91;
    --primary-light: #1e60c2;
    --bg-light: #f0f4f8;
    --bg-dark: #121212;
    --text-light: #ffffff;
    --text-dark: #000000;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: Arial, sans-serif;
    display: flex; flex-direction: column;
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }
  body.light { background: var(--bg-light); color: var(--text-dark);}
  body.dark { background: var(--bg-dark); color: var(--text-light);}
  header {
    background: var(--primary-dark);
    color: white;
    text-align: center;
    padding: 15px;
    font-size: 24px;
    font-weight: bold;
    display: flex; justify-content: space-between; align-items: center;
  }
  header button {
    background: var(--primary-light);
    border: none;
    color: white;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
  }
  nav {
    display: flex;
    background: white;
    border-bottom: 1px solid #ccc;
    overflow-x: auto;
  }
  nav button {
    flex: 1;
    padding: 12px;
    border: none;
    background: white;
    cursor: pointer;
    font-size: 16px;
    transition: 0.2s;
  }
  nav button.active { background: var(--primary-dark); color: white; font-weight: bold; }
  main { flex: 1; padding: 15px; }
  #taskForm { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
  input[type="text"], input[type="time"] {
    flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px;
  }
  button#addTask { background: var(--primary-light); color: white; border: none; border-radius: 6px; padding: 10px 15px; cursor: pointer; font-size: 16px; }
  ul { list-style: none; padding: 0; margin: 0; }
  li {
    display: flex; align-items: center;
    background: white; padding: 10px; margin-bottom: 10px; border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  li.completed label { text-decoration: line-through; color: gray; }
  li input[type="checkbox"] { margin-right: 10px; width: 20px; height: 20px; }
  li span.time { font-weight: bold; color: var(--primary-dark); margin-right: 10px; }
  li button { margin-left: auto; background: #f44336; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; }
  li button:hover { background: #d32f2f; }
  #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 15px; }
  #calendar button { padding: 10px; border: none; border-radius: 5px; cursor: pointer; background: var(--primary-light); color: white; }
  #calendar button.selected { background: var(--primary-dark); }
</style>
</head>
<body class="dark">
<header>
  Agenda Digital
  <button id="toggleTheme">ðŸŒ™</button>
</header>

<nav id="weekTabs">
  <button data-day="segunda" class="active">Seg</button>
  <button data-day="terca">Ter</button>
  <button data-day="quarta">Qua</button>
  <button data-day="quinta">Qui</button>
  <button data-day="sexta">Sex</button>
  <button data-day="sabado">SÃ¡b</button>
  <button data-day="domingo">Dom</button>
</nav>

<main>
  <div id="calendar"></div>
  <div id="taskForm">
    <input type="time" id="taskTime">
    <input type="text" id="taskInput" placeholder="Digite uma tarefa...">
    <button id="addTask">Adicionar</button>
  </div>
  <ul id="taskList"></ul>
</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll("nav button");
  const taskList = document.getElementById("taskList");
  const taskInput = document.getElementById("taskInput");
  const taskTime = document.getElementById("taskTime");
  const addTaskBtn = document.getElementById("addTask");
  const toggleThemeBtn = document.getElementById("toggleTheme");
  const calendar = document.getElementById("calendar");

  let currentDay = "segunda";
  let currentDate = new Date().toISOString().split("T")[0]; // YYYY-MM-DD
  let tasks = JSON.parse(localStorage.getItem("tasks")) || {};

  // Calcular calendÃ¡rio mensal
  function renderCalendar() {
    calendar.innerHTML = "";
    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    const lastDay = new Date(today.getFullYear(), today.getMonth() +1, 0);
    for(let i=1; i<=lastDay.getDate(); i++){
      const btn = document.createElement("button");
      const fullDate = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
      btn.textContent = i;
      if(fullDate === currentDate) btn.classList.add("selected");
      btn.addEventListener("click", ()=>{ currentDate=fullDate; renderTasks(); renderCalendar(); });
      calendar.appendChild(btn);
    }
  }

  renderCalendar();

  // Semana
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      currentDay = tab.dataset.day;
      renderTasks();
    });
  });

  // Tema
  toggleThemeBtn.addEventListener("click", ()=>{
    if(document.body.classList.contains("dark")){
      document.body.classList.remove("dark");
      document.body.classList.add("light");
      toggleThemeBtn.textContent="ðŸŒ™";
    } else {
      document.body.classList.remove("light");
      document.body.classList.add("dark");
      toggleThemeBtn.textContent="â˜€ï¸";
    }
  });

  addTaskBtn.addEventListener("click", ()=>{
    const text = taskInput.value.trim();
    const time = taskTime.value;
    if(!text) return alert("Digite uma tarefa!");
    if(!tasks[currentDate]) tasks[currentDate]=[];
    tasks[currentDate].push({text,time,done:false});
    saveTasks();
    scheduleNotification(text,time,currentDate);
    taskInput.value=""; taskTime.value="";
    renderTasks();
  });

  function toggleTask(date,index){
    tasks[date][index].done = !tasks[date][index].done;
    saveTasks();
    renderTasks();
  }

  function deleteTask(date,index){
    tasks[date].splice(index,1);
    saveTasks();
    renderTasks();
  }

  function renderTasks(){
    taskList.innerHTML="";
    (tasks[currentDate]||[]).forEach((task,i)=>{
      const li=document.createElement("li");
      if(task.done) li.classList.add("completed");
      li.innerHTML=`
        <input type="checkbox" ${task.done?"checked":""}>
        <span class="time">${task.time||"--:--"}</span>
        <label>${task.text}</label>
        <button>Excluir</button>
      `;
      li.querySelector("input").addEventListener("change", ()=>toggleTask(currentDate,i));
      li.querySelector("button").addEventListener("click", ()=>deleteTask(currentDate,i));
      taskList.appendChild(li);
    });
  }

  function saveTasks(){ localStorage.setItem("tasks",JSON.stringify(tasks)); }

  // NotificaÃ§Ãµes
  function scheduleNotification(text,time,date){
    if(!("Notification" in window)) return;
    if(Notification.permission==="granted"){
      const [h,m]=time.split(":");
      const now=new Date();
      const alarm=new Date(date+"T"+time+":00");
      if(alarm<now) return;
      const delay = alarm-now;
      setTimeout(()=>{ new Notification("Agenda Digital",{body:`${time} - ${text}`, icon:"https://cdn-icons-png.flaticon.com/512/2933/2933245.png"}); },delay);
    } else if(Notification.permission!=="denied"){ Notification.requestPermission(); }
  }

  renderTasks();
});

// PWA offline
if("serviceWorker" in navigator){
  window.addEventListener("load",()=>{
    const swCode=`
      const CACHE_NAME='agenda-digital-v1';
      const urlsToCache=['.'];
      self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE_NAME).then(c=>c.addAll(urlsToCache)));});
      self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));});
    `;
    const blob=new Blob([swCode],{type:'text/javascript'});
    const swUrl=URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl);
  });
}
</script>
</body>
</html>
